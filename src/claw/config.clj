(ns claw.config
  (:use [environ.core]
        ))

;; Set overrides in your ~/.lein/profiles.clj for development mode.

(def default-configuration
  "This is the base configuration from which mode-specific configuration maps are derived."
  {
   :database-host "localhost"
   :database-port "5432"

   :show-web-stacktraces false

   :app-human-name "<Unnamed application!>" ;; Human-readable name of the application

   ;; Maven-*-name are used for auto-finding the app's version number.
   ;; These are auto-set in the app-level config files generated by claw-template.
   :maven-artifact-name nil
   :maven-group-name nil

   :nrepl-port "7888"

   :auto-reload false ;; Adds ring.middleware.reload if true.

   :auto-start-webserver true ;; Starts a Noir server at boot time automatically if true.
   :auto-start-nrepl true
   }
  )

(def defaults
  "Application default configurations by mode."
  {

   :dev (merge default-configuration
               {
                :mode "dev"
                :web-port "3000"
                
                :database-name "claw-development"
                :database-user "claw-development"
                :database-password ""
                
                :show-web-stacktraces true
                :auto-reload true
                
                })
   
   :production (merge default-configuration
                      {
                       :mode "production"
                       :web-port "8080"
                       
                       :database-name "claw-production"   
                       :database-user "claw-production"
                       :database-password ""
                       
                       })
   })


(def mode
  "The application's run mode, which selects the default settings used.

Valid values are \"production\" or \"dev\".
Any unknown value is ignored and puts the app into dev mode.
"
  (case (env :mode)
        "production" :production
        "dev" :dev
        :dev)) ;; TODO: log an error on unknown values

(defn config
  "Returns the current configuration value for the given key.

If an environment variable is set named key, config returns that value.

Config values can also be set in `~/.lein/profiles.clj` (see https://github.com/weavejester/environ for examples.)

If neither of the above locations contains a value, the default config map for the current operating mode is consulted.
"
  [key] (or (env key) ((mode defaults) key)))